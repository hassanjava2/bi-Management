# BI ERP - المخطط الشامل V2

## 🆕 الإضافات الجديدة

---

## 📱 تطبيق الموبايل + باركود

### مميزات التطبيق:
```
┌─────────────────────────────────────────────────────────────┐
│  📱 BI Mobile                                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🔲 مسح باركود / QR                                        │
│                                                             │
│  • مسح سيريال → تفاصيل الجهاز كاملة                        │
│  • مسح باركود منتج → معلومات المنتج                        │
│  • مسح فاتورة → تفاصيل الفاتورة                            │
│                                                             │
│  📷 كاميرا                                                  │
│  • تصوير الجهاز عند الفحص                                  │
│  • تصوير العيوب والخدوش                                    │
│  • تسجيل فيديو للشحن                                       │
│                                                             │
│  🏷️ طباعة                                                   │
│  • طباعة ستيكر السيريال                                    │
│  • طباعة باركود                                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### ستيكر السيريال:
```
┌─────────────────────────────┐
│  BI Company                 │
│  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓        │  ← باركود
│  BI-2025-001234             │
│  Dell Latitude 7410         │
│  i7-11th | 32GB | 512GB     │
└─────────────────────────────┘
```

---

## 👥 صلاحيات محدثة (الموظف ما يشوف الأسعار)

### جدول الصلاحيات:
| الميزة | المدير | الفاحص | المبيعات | المخزن |
|--------|--------|--------|----------|--------|
| سعر الشراء | ✅ | ❌ | ❌ | ❌ |
| سعر البيع | ✅ | ❌ | ✅ | ❌ |
| إضافة مشتريات | ✅ | ❌ | ❌ | ✅* |
| الفحص | ✅ | ✅ | ❌ | ❌ |
| البيع | ✅ | ❌ | ✅ | ❌ |
| التقارير المالية | ✅ | ❌ | ❌ | ❌ |
| تتبع التوصيل | ✅ | ❌ | ✅ | ❌ |

*المخزن يضيف المواد بدون أسعار

### سير عمل الشراء الجديد:

```
┌─────────────────────────────────────────────────────────────┐
│  الموظف (أمين المخزن)                                       │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  1. إضافة فاتورة شراء                                       │
│     ─────────────────────                                   │
│     • اختيار المورد                                         │
│     • إضافة المنتجات (الكمية والمواصفات فقط)                │
│     • ❌ لا يظهر سعر الشراء                                 │
│     • ❌ لا يظهر سعر البيع                                  │
│     • الحالة: "بانتظار الأسعار"                             │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  ⚡ إشعار للمدير                                            │
│     "فاتورة شراء جديدة من [المورد] - 20 قطعة"              │
│     "بانتظار إضافة الأسعار"                                 │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  المدير                                                     │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  2. إضافة سعر الشراء                                        │
│     ─────────────────────                                   │
│     • يفتح الفاتورة                                         │
│     • يضيف سعر الشراء لكل منتج                              │
│     • يحفظ                                                  │
│     • الحالة: "جاهزة للاستلام"                              │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  ⚡ إشعار للموظف                                            │
│     "وجبة جديدة جاهزة - 20 قطعة من [المورد]"               │
│     "ابدأ لصق السيريال والفحص"                              │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  الموظف (الفاحص)                                            │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  3. الاستلام والفحص                                         │
│     ─────────────────────                                   │
│     • طباعة ستيكرات السيريال                                │
│     • لصق على كل جهاز                                       │
│     • فحص كل جهاز وتسجيل المواصفات الفعلية                  │
│     • تصوير العيوب إن وجدت                                  │
│     • ❌ لا يشوف الأسعار                                    │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  ⚡ إشعار للمدير                                            │
│     "اكتمل فحص وجبة [المورد]"                               │
│     "3 أجهزة بفروقات - تحتاج مراجعة"                        │
│     "بانتظار تحديد أسعار البيع"                             │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  المدير                                                     │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  4. تحديد أسعار البيع                                       │
│     ─────────────────────                                   │
│     • مراجعة نتائج الفحص                                    │
│     • تحديد سعر البيع لكل جهاز حسب مواصفاته الفعلية         │
│     • الأجهزة الأفضل = سعر أعلى                             │
│     • الأجهزة الأقل = سعر أقل + مطالبة المورد               │
│     • الحالة: "جاهز للبيع"                                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 🚚 نظام التوصيل والشحن

### جدول شركات التوصيل (DeliveryCompanies)
| الحقل | النوع | الوصف |
|-------|-------|-------|
| id | UUID | معرف فريد |
| name | string | اسم الشركة (برايم، طلبات، تكسي) |
| type | enum | النوع (company, taxi, pickup) |
| contact | string | رقم التواصل |
| balance | decimal | الرصيد (المبالغ عندهم) |
| pending_orders | int | عدد الطلبات المعلقة |

### جدول الشحنات (Shipments)
| الحقل | النوع | الوصف |
|-------|-------|-------|
| id | UUID | معرف فريد |
| sale_id | FK | فاتورة البيع |
| delivery_company_id | FK | شركة التوصيل |
| **status** | enum | الحالة |
| tracking_number | string | رقم التتبع |
| shipped_at | timestamp | تاريخ الشحن |
| delivered_at | timestamp | تاريخ التسليم |
| returned_at | timestamp | تاريخ الإرجاع (إذا رجع) |
| delivery_fee | decimal | أجرة التوصيل |
| cod_amount | decimal | المبلغ المطلوب تحصيله |
| collected_amount | decimal | المبلغ المحصل |
| **video_url** | string | فيديو التغليف |
| **photos** | array | صور الشحنة |
| notes | text | ملاحظات |

#### حالات الشحنة:
```
preparing → قيد التجهيز (تصوير وتغليف)
handed_to_delivery → سُلمت لشركة التوصيل
in_transit → في الطريق
delivered → تم التسليم
returned → مرتجع
partially_returned → مرتجع جزئياً
```

### سير عمل الشحن:

```
┌─────────────────────────────────────────────────────────────┐
│  1. إنشاء فاتورة بيع (آجل)                                  │
│     ─────────────────────────                               │
│     • اختيار الزبون                                         │
│     • اختيار الأجهزة (بالسيريال)                            │
│     • تحديد طريقة الدفع: آجل                                │
│     • اختيار طريقة التوصيل                                  │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  2. تجهيز الشحنة                                            │
│     ─────────────────────────                               │
│     📹 تسجيل فيديو التغليف (إلزامي)                        │
│     📷 تصوير الأجهزة قبل الشحن                              │
│     📦 تغليف                                                │
│     🏷️ طباعة بوليصة الشحن                                  │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│  3. تسليم لشركة التوصيل                                     │
│     ─────────────────────────                               │
│     • اختيار الشركة (برايم، تكسي، الخ)                      │
│     • إدخال رقم التتبع (إن وجد)                             │
│     • تأكيد التسليم                                         │
│                                                             │
│     📊 الفاتورة الآن:                                       │
│     • على ذمة شركة التوصيل                                  │
│     • تظهر في "شحنات معلقة"                                 │
└─────────────────────────────────────────────────────────────┘
         │
         ├─────────────────┬─────────────────┐
         ▼                 ▼                 ▼
┌───────────────┐ ┌───────────────┐ ┌───────────────┐
│  تم التسليم   │ │   مرتجع      │ │ مرتجع جزئي   │
│               │ │              │ │              │
│ • تأكيد      │ │ • استلام    │ │ • تحديد     │
│ • تحصيل     │ │   الراجع     │ │   المرتجع   │
│   المبلغ     │ │ • إرجاع     │ │ • تحصيل    │
│   من الشركة  │ │   للمخزون   │ │   الباقي    │
└───────────────┘ └───────────────┘ └───────────────┘
```

### لوحة شركات التوصيل:

```
╔════════════════════════════════════════════════════════════════╗
║  🚚 شركات التوصيل                                             ║
╠════════════════════════════════════════════════════════════════╣
║                                                                ║
║  شركة برايم للتوصيل                                           ║
║  ├─ شحنات معلقة: 12                                           ║
║  ├─ مبلغ معلق: 15,450,000 د.ع                                 ║
║  └─ [عرض التفاصيل]                                            ║
║                                                                ║
║  تكسي                                                          ║
║  ├─ شحنات معلقة: 3                                            ║
║  ├─ مبلغ معلق: 2,100,000 د.ع                                  ║
║  └─ [عرض التفاصيل]                                            ║
║                                                                ║
║  استلام شخصي                                                   ║
║  ├─ بانتظار الاستلام: 5                                       ║
║  └─ [عرض التفاصيل]                                            ║
║                                                                ║
╠════════════════════════════════════════════════════════════════╣
║  إجمالي معلق: 17,550,000 د.ع                                  ║
╚════════════════════════════════════════════════════════════════╝
```

---

## 📍 سجل حركة الجهاز (Device Movement Log)

### جدول حركة الجهاز (DeviceMovements)
| الحقل | النوع | الوصف |
|-------|-------|-------|
| id | UUID | معرف فريد |
| device_id | FK | الجهاز |
| movement_type | enum | نوع الحركة |
| from_location | string | من |
| to_location | string | إلى |
| performed_by | FK | بواسطة |
| timestamp | timestamp | الوقت |
| notes | text | ملاحظات |
| **photos** | array | صور |
| **video_url** | string | فيديو |
| related_document | string | المستند المرتبط |

#### أنواع الحركة:
```
received → استلام من المورد
inspected → فحص
moved_to_warehouse → نقل للمخزن
moved_to_display → نقل للعرض
reserved → حجز لزبون
sold → بيع
shipped → شحن
delivered → تسليم للزبون
returned_by_customer → إرجاع من الزبون
sent_to_supplier → إرسال للمورد
received_from_supplier → استلام من المورد
repaired → صيانة
```

### شاشة تتبع الجهاز:

```
╔════════════════════════════════════════════════════════════════╗
║  📍 تتبع جهاز: BI-2025-001234                                 ║
║  Dell Latitude 7410 | i7-11th | 32GB | 512GB                  ║
╠════════════════════════════════════════════════════════════════╣
║                                                                ║
║  الحالة الحالية: ✅ مباع - عند الزبون                         ║
║                                                                ║
║  ─────────────────────────────────────────────────────────    ║
║  📦 سجل الحركة                                                ║
║  ─────────────────────────────────────────────────────────    ║
║                                                                ║
║  2025-01-15 09:00 │ 📥 استلام من المورد                       ║
║                   │    المورد: العربي                          ║
║                   │    فاتورة: PO-2025-0089                    ║
║                   │    📷 [3 صور]                              ║
║                   │                                            ║
║  2025-01-15 09:30 │ 🏷️ لصق السيريال                           ║
║                   │    بواسطة: حيدر                            ║
║                   │                                            ║
║  2025-01-15 14:30 │ 🔍 فحص                                    ║
║                   │    بواسطة: حيدر                            ║
║                   │    النتيجة: ✅ ناجح                        ║
║                   │    ⚠️ فرق: رام 16 بدل 32                  ║
║                   │    📷 [2 صور للمواصفات]                    ║
║                   │                                            ║
║  2025-01-15 15:00 │ ➡️ نقل للمخزن الرئيسي                     ║
║                   │    بواسطة: حيدر                            ║
║                   │                                            ║
║  2025-01-18 10:00 │ 🛒 بيع                                    ║
║                   │    الزبون: أحمد محمد                       ║
║                   │    فاتورة: INV-2025-0234                   ║
║                   │    السعر: 850,000 د.ع                      ║
║                   │                                            ║
║  2025-01-18 10:30 │ 📹 تجهيز للشحن                            ║
║                   │    بواسطة: علي                             ║
║                   │    📹 [فيديو التغليف]                      ║
║                   │    📷 [4 صور]                              ║
║                   │                                            ║
║  2025-01-18 11:00 │ 🚚 تسليم لشركة برايم                      ║
║                   │    رقم التتبع: PR-78945                    ║
║                   │                                            ║
║  2025-01-19 14:00 │ ✅ تم التسليم للزبون                      ║
║                   │    تأكيد من شركة برايم                     ║
║                   │                                            ║
╚════════════════════════════════════════════════════════════════╝
```

---

## 📷 نظام الصور والفيديو

### جدول الوسائط (DeviceMedia)
| الحقل | النوع | الوصف |
|-------|-------|-------|
| id | UUID | معرف فريد |
| device_id | FK | الجهاز |
| type | enum | النوع (photo, video) |
| category | enum | التصنيف |
| file_path | string | مسار الملف |
| thumbnail | string | صورة مصغرة |
| uploaded_by | FK | رفع بواسطة |
| uploaded_at | timestamp | تاريخ الرفع |
| notes | text | ملاحظات |

#### تصنيفات الصور:
```
inspection_photo → صورة فحص
defect_photo → صورة عيب/خدش
specs_photo → صورة المواصفات (الملصق)
packaging_photo → صورة التغليف
shipping_video → فيديو الشحن
condition_photo → صورة الحالة
serial_photo → صورة السيريال الأصلي
```

### شاشة إضافة صور للعيوب:

```
╔════════════════════════════════════════════════════════════════╗
║  📷 توثيق العيوب - BI-2025-001234                             ║
╠════════════════════════════════════════════════════════════════╣
║                                                                ║
║  ⚠️ تم اكتشاف عيب                                             ║
║                                                                ║
║  نوع العيب: [ خدش ▼ ]                                         ║
║                                                                ║
║  موقع العيب: [ الغطاء الخلفي ▼ ]                              ║
║                                                                ║
║  الوصف: [خدش صغير على الزاوية اليمنى_______________]         ║
║                                                                ║
║  ┌──────────────────────────────────────────────┐              ║
║  │                                              │              ║
║  │         📷 اضغط لالتقاط صورة                │              ║
║  │                                              │              ║
║  └──────────────────────────────────────────────┘              ║
║                                                                ║
║  الصور الملتقطة:                                               ║
║  ┌────┐ ┌────┐ ┌────┐                                         ║
║  │ 📷 │ │ 📷 │ │ +  │                                         ║
║  └────┘ └────┘ └────┘                                         ║
║                                                                ║
║              [ حفظ وإنشاء مطالبة للمورد ]                      ║
╚════════════════════════════════════════════════════════════════╝
```

---

## 📊 جداول إضافية

### جدول المدفوعات (Payments)
| الحقل | النوع | الوصف |
|-------|-------|-------|
| id | UUID | معرف فريد |
| type | enum | النوع (customer_payment, supplier_payment, delivery_collection) |
| related_id | UUID | الفاتورة/الشركة |
| amount | decimal | المبلغ |
| payment_method | enum | طريقة الدفع |
| received_by | FK | استلم بواسطة |
| date | timestamp | التاريخ |
| notes | text | ملاحظات |

### جدول الإشعارات المحدث (Notifications)
| الحقل | النوع | الوصف |
|-------|-------|-------|
| id | UUID | معرف فريد |
| type | enum | النوع |
| recipient_id | FK | المستلم |
| title | string | العنوان |
| body | text | المحتوى |
| action_url | string | رابط الإجراء |
| priority | enum | الأولوية |
| read | boolean | مقروء |
| created_at | timestamp | التاريخ |

#### أنواع الإشعارات الجديدة:
```
new_purchase_order → فاتورة شراء جديدة (للمدير)
prices_added → تم إضافة الأسعار (للموظف)
shipment_ready → وجبة جاهزة للفحص (للفاحص)
inspection_complete → اكتمل الفحص (للمدير)
price_adjustment_needed → يحتاج تسعير (للمدير)
shipment_delivered → تم التسليم (للمبيعات)
shipment_returned → مرتجع (للمبيعات)
collection_pending → تحصيل معلق (للمحاسبة)
defect_reported → عيب مكتشف (للمدير)
```

---

## 🔔 نظام الإشعارات

```
┌─────────────────────────────────────────────────────────────┐
│  📱 إشعارات فورية (Push Notifications)                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  للمدير:                                                    │
│  ├─ فاتورة شراء جديدة تحتاج أسعار                          │
│  ├─ فحص مكتمل يحتاج تسعير بيع                              │
│  ├─ عيوب مكتشفة                                            │
│  ├─ مطالبات موردين                                         │
│  └─ تقرير يومي                                             │
│                                                             │
│  للفاحص:                                                    │
│  ├─ وجبة جديدة جاهزة للفحص                                 │
│  └─ تذكير بأجهزة معلقة                                     │
│                                                             │
│  للمبيعات:                                                  │
│  ├─ شحنة تم تسليمها                                        │
│  ├─ شحنة مرتجعة                                            │
│  └─ تحصيل معلق                                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 💼 ملخص الميزات

### ✅ المشتريات:
- [ ] الموظف يضيف بدون أسعار
- [ ] المدير يضيف سعر الشراء
- [ ] إشعار عند إضافة الأسعار
- [ ] توليد سيريال تلقائي

### ✅ الفحص:
- [ ] تطبيق موبايل + باركود
- [ ] تسجيل المواصفات الفعلية
- [ ] تصوير العيوب والخدوش
- [ ] إشعار للمدير عند الاكتمال

### ✅ التسعير:
- [ ] المدير يحدد سعر البيع بعد الفحص
- [ ] تسعير حسب المواصفات الفعلية
- [ ] الموظفين لا يرون سعر الشراء

### ✅ البيع والشحن:
- [ ] فواتير آجلة
- [ ] اختيار شركة التوصيل
- [ ] فيديو إلزامي للتغليف
- [ ] تتبع الشحنات
- [ ] إدارة المرتجعات

### ✅ التتبع:
- [ ] سجل حركة كامل بالسيريال
- [ ] صور وفيديو لكل مرحلة
- [ ] مسح باركود للاستعلام الفوري

---

## 🛠️ خطة التنفيذ

### المرحلة 1 - الأساس (2-3 أسابيع):
1. قاعدة البيانات
2. API أساسي
3. واجهة الويب للمدير

### المرحلة 2 - الموبايل (2 أسابيع):
1. تطبيق الموبايل
2. مسح الباركود
3. الكاميرا والتصوير

### المرحلة 3 - الشحن (1 أسبوع):
1. نظام التوصيل
2. تتبع الشحنات
3. التحصيل

### المرحلة 4 - التحسينات (مستمر):
1. التقارير
2. التنبيهات الذكية
3. التحليلات

---

هل تريد نبدأ التنفيذ؟
