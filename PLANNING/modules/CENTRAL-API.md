# ğŸ”— Central API - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…ÙˆØ­Ø¯Ø©

> **Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:** 2026-02-01
> **Ø§Ù„Ù‡Ø¯Ù:** Ø±Ø¨Ø· Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø¸Ù…Ø© BI Ø¨Ø¨Ø¹Ø¶Ù‡Ø§

---

## ğŸ¯ Ø§Ù„Ù‡Ø¯Ù

API Ù…ÙˆØ­Ø¯ ÙŠØ±Ø¨Ø·:
- BI ERP (Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ)
- Saeed ERP (Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ - Ø³ÙŠØ¯ Ø·Ø§Ù‡Ø±)
- BI Store (Ø§Ù„Ù…ÙˆÙ‚Ø¹ - Ø­ÙŠØ¯Ø±)
- BI App (Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹)

---

## ğŸ—ï¸ Ø§Ù„Ø¨Ù†ÙŠØ©

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Central API      â”‚
                    â”‚    (Node.js)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                â”‚                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   BI ERP      â”‚ â”‚  Saeed ERP    â”‚ â”‚   BI Store    â”‚
    â”‚   (Internal)  â”‚ â”‚  (Sales)      â”‚ â”‚   (Website)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ Endpoints

### 1. Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Products)

```
GET  /api/products              â†’ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
GET  /api/products/:id          â†’ Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯
POST /api/products              â†’ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ (BI ERP ÙÙ‚Ø·)
PUT  /api/products/:id          â†’ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ (BI ERP ÙÙ‚Ø·)

âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: buy_price Ù„Ø§ ÙŠÙØ±Ø³Ù„ Ø¥Ù„Ø§ Ù„Ù€ BI ERP
```

**Response Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©:**
```json
{
  "id": "uuid",
  "name": "Dell Latitude 5530",
  "barcode": "123456789",
  "category": "Laptops",
  "brand": "Dell",
  "sell_price": 450000,
  "stock": 5,
  "specs": {...},
  "images": [...]
}
```

**Response Ù„Ù€ BI ERP (Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ©):**
```json
{
  "id": "uuid",
  "name": "Dell Latitude 5530",
  "barcode": "123456789",
  "buy_price": 350000,        // ğŸ”’ Ø³Ø±ÙŠ
  "sell_price": 450000,
  "profit_margin": 100000,    // ğŸ”’ Ø³Ø±ÙŠ
  "profit_percentage": 28.5,  // ğŸ”’ Ø³Ø±ÙŠ
  "stock": 5,
  ...
}
```

---

### 2. Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Inventory)

```
GET  /api/inventory                 â†’ ÙƒÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
GET  /api/inventory/:product_id     â†’ Ù…Ø®Ø²ÙˆÙ† Ù…Ù†ØªØ¬
POST /api/inventory/movement        â†’ Ø­Ø±ÙƒØ© Ù…Ø®Ø²ÙˆÙ†
GET  /api/inventory/low-stock       â†’ Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø©
```

---

### 3. Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª (Returns) - BI ERP ÙÙ‚Ø·

```
GET    /api/returns                 â†’ ÙƒÙ„ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª
GET    /api/returns/pending         â†’ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
GET    /api/returns/:id             â†’ ØªÙØ§ØµÙŠÙ„ Ù…Ø±ØªØ¬Ø¹
POST   /api/returns                 â†’ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø±ØªØ¬Ø¹
PUT    /api/returns/:id             â†’ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø©
POST   /api/returns/:id/follow-up   â†’ Ø¥Ø¶Ø§ÙØ© Ù…ØªØ§Ø¨Ø¹Ø©
GET    /api/returns/alerts          â†’ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
```

---

### 4. Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Orders) - Ù…Ù† BI Store

```
GET  /api/orders                    â†’ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
GET  /api/orders/:id                â†’ Ø·Ù„Ø¨ ÙˆØ§Ø­Ø¯
POST /api/orders                    â†’ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹)
PUT  /api/orders/:id/status         â†’ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
```

---

### 5. Ø§Ù„ÙÙˆØ§ØªÙŠØ± (Invoices) - Ù…Ù† Saeed ERP

```
GET  /api/invoices                  â†’ ÙƒÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
POST /api/invoices                  â†’ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
GET  /api/invoices/:id              â†’ ØªÙØ§ØµÙŠÙ„ ÙØ§ØªÙˆØ±Ø©
```

---

### 6. Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (Reports) - BI ERP ÙÙ‚Ø·

```
GET /api/reports/sales              â†’ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
GET /api/reports/profits            â†’ ğŸ”’ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
GET /api/reports/returns            â†’ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª
GET /api/reports/inventory          â†’ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
```

---

## ğŸ” Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Authentication)

### Ù†Ø¸Ø§Ù… API Keys:
```
BI_ERP_KEY      = "bi-erp-xxx..."      // ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©
SAEED_ERP_KEY   = "saeed-xxx..."       // ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø­Ø¯ÙˆØ¯Ø©
BI_STORE_KEY    = "store-xxx..."       // ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø­Ø¯ÙˆØ¯Ø©
```

### Headers:
```
Authorization: Bearer <API_KEY>
X-System-ID: bi-erp | saeed-erp | bi-store
```

### ØµÙ„Ø§Ø­ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù…:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Endpoint        â”‚ BI ERP  â”‚ Saeed ERP â”‚ BI Store â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Products (read) â”‚ âœ… ÙƒØ§Ù…Ù„ â”‚ âœ… Ù…Ø­Ø¯ÙˆØ¯  â”‚ âœ… Ù…Ø­Ø¯ÙˆØ¯ â”‚
â”‚ Products (write)â”‚ âœ…      â”‚ âŒ        â”‚ âŒ       â”‚
â”‚ Buy Prices      â”‚ âœ…      â”‚ âŒ        â”‚ âŒ       â”‚
â”‚ Inventory       â”‚ âœ…      â”‚ âœ… Ù‚Ø±Ø§Ø¡Ø©  â”‚ âœ… Ù‚Ø±Ø§Ø¡Ø© â”‚
â”‚ Returns         â”‚ âœ…      â”‚ âŒ        â”‚ âŒ       â”‚
â”‚ Orders          â”‚ âœ…      â”‚ âœ…        â”‚ âœ…       â”‚
â”‚ Invoices        â”‚ âœ…      â”‚ âœ…        â”‚ âŒ       â”‚
â”‚ Reports         â”‚ âœ…      â”‚ Ù…Ø­Ø¯ÙˆØ¯     â”‚ âŒ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Webhooks (Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ)

### Ù…Ù† BI ERP Ù„Ù„Ø¢Ø®Ø±ÙŠÙ†:
```
POST /webhook/product-updated     â†’ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬
POST /webhook/stock-changed       â†’ Ø¹Ù†Ø¯ ØªØºÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
POST /webhook/price-changed       â†’ Ø¹Ù†Ø¯ ØªØºÙŠØ± Ø§Ù„Ø³Ø¹Ø±
```

### Ù…Ù† Saeed ERP Ù„Ù€ BI ERP:
```
POST /webhook/invoice-created     â†’ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
POST /webhook/sale-completed      â†’ Ø¨ÙŠØ¹ Ù…ÙƒØªÙ…Ù„
POST /webhook/warranty-claim      â†’ Ø·Ù„Ø¨ Ø¶Ù…Ø§Ù†
```

### Ù…Ù† BI Store Ù„Ù€ BI ERP:
```
POST /webhook/order-created       â†’ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
POST /webhook/order-paid          â†’ ØªÙ… Ø§Ù„Ø¯ÙØ¹
POST /webhook/order-cancelled     â†’ Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨
```

---

## ğŸ—„ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©

```sql
-- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Shared)
shared_products         -- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
shared_categories       -- Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
shared_brands          -- Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª
shared_inventory       -- Ø§Ù„Ù…Ø®Ø²ÙˆÙ†

-- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ BI ERP (Private)
private_buy_prices     -- ğŸ”’ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
private_profits        -- ğŸ”’ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
private_suppliers      -- ğŸ”’ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
private_employees      -- ğŸ”’ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†

-- Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ²Ø§Ù…Ù†
sync_logs              -- Ø³Ø¬Ù„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
webhook_queue          -- Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ù€ webhooks
```

---

## âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ²Ø§Ù…Ù†

```javascript
// config/sync.js
module.exports = {
  // Ø§Ù„ØªØ²Ø§Ù…Ù† Ù…Ø¹ Saeed ERP
  saeedErp: {
    url: 'https://saeed-erp.bi-iraq.com/api',
    key: process.env.SAEED_ERP_KEY,
    syncInterval: 5 * 60 * 1000,  // 5 Ø¯Ù‚Ø§Ø¦Ù‚
    syncProducts: true,
    syncInventory: true,
    syncInvoices: true,
    sendBuyPrices: false  // âš ï¸ Ù…Ù‡Ù…!
  },
  
  // Ø§Ù„ØªØ²Ø§Ù…Ù† Ù…Ø¹ BI Store
  biStore: {
    url: 'https://store.bi-iraq.com/api',
    key: process.env.BI_STORE_KEY,
    syncInterval: 1 * 60 * 1000,  // Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©
    syncProducts: true,
    syncInventory: true,
    syncOrders: true,
    sendBuyPrices: false  // âš ï¸ Ù…Ù‡Ù…!
  }
};
```

---

## ğŸ§ª Ù…Ø«Ø§Ù„ ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ: Ø¨ÙŠØ¹ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹
```
1. Ø²Ø¨ÙˆÙ† ÙŠØ·Ù„Ø¨ Ù…Ù† BI Store
   â”‚
   â””â”€â–º BI Store â†’ POST /api/orders
                  â”‚
2. Central API ÙŠØ³ØªÙ„Ù… Ø§Ù„Ø·Ù„Ø¨
   â”‚
   â””â”€â–º ÙŠÙØ­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
   â”‚
   â””â”€â–º Webhook â†’ BI ERP (Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯!)
   â”‚
3. BI ERP ÙŠØ¹Ø§Ù„Ø¬ Ø§Ù„Ø·Ù„Ø¨
   â”‚
   â””â”€â–º ÙŠØ­Ø¬Ø² Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
   â”‚
   â””â”€â–º Webhook â†’ BI Store (ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯)
   â”‚
   â””â”€â–º Webhook â†’ Saeed ERP (Ù„Ù„ÙÙˆØªØ±Ø©)
   â”‚
4. Saeed ERP ÙŠÙÙ†Ø´Ø¦ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
   â”‚
   â””â”€â–º Webhook â†’ BI ERP (ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©)
   â”‚
5. BI ERP ÙŠÙØ­Ø¯Ø« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
   â”‚
   â””â”€â–º Webhook â†’ BI Store (Ù…Ø®Ø²ÙˆÙ† Ø¬Ø¯ÙŠØ¯)
```

---

## ğŸ“ Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°

```
D:\bi Management\backend\
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ products.js
â”‚   â”‚   â”œâ”€â”€ inventory.js
â”‚   â”‚   â”œâ”€â”€ returns.js
â”‚   â”‚   â”œâ”€â”€ orders.js
â”‚   â”‚   â””â”€â”€ invoices.js
â”‚   â”œâ”€â”€ webhooks/
â”‚   â”‚   â”œâ”€â”€ receiver.js
â”‚   â”‚   â””â”€â”€ sender.js
â”‚   â”œâ”€â”€ sync/
â”‚   â”‚   â”œâ”€â”€ saeed-erp.js
â”‚   â”‚   â””â”€â”€ bi-store.js
â”‚   â””â”€â”€ middleware/
â”‚       â”œâ”€â”€ auth.js
â”‚       â””â”€â”€ permissions.js
â””â”€â”€ config/
    â”œâ”€â”€ api-keys.js
    â””â”€â”€ sync.js
```

---

## âœ… Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°

1. [ ] Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
2. [ ] Ø¥Ù†Ø´Ø§Ø¡ API Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
3. [ ] Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
4. [ ] Endpoints Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†
5. [ ] Ù†Ø¸Ø§Ù… Webhooks
6. [ ] Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Saeed ERP
7. [ ] Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ BI Store
8. [ ] Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„ØªÙˆØ«ÙŠÙ‚

---

*Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: 2026-02-01*
