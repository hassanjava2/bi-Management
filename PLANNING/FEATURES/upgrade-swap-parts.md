# 🔧 نظام ترقية/تبديل القطع (Upgrade & Swap)

## الفكرة

عند البيع، الزبون يطلب ترقية (مثل رام 8 → 16):

### السيناريو 1: إضافة قطعة
```
اللابتوب: رام 8GB (سلوت واحد مشغول)
الطلب: رام 16GB

الحل: إضافة رام 8GB ثاني
      8GB + 8GB = 16GB

المخزون:
  - رام 8GB: -1
```

### السيناريو 2: استبدال قطعة
```
اللابتوب: رام 8GB
الطلب: رام 16GB

الحل: سحب 8GB، تركيب 16GB

المخزون:
  - رام 8GB: +1 (رجعت للمخزون)
  - رام 16GB: -1 (راحت للزبون)
```

### السيناريو 3: ترقية هارد
```
اللابتوب: هارد 256GB SSD
الطلب: هارد 512GB SSD

الحل: سحب 256، تركيب 512

المخزون:
  - SSD 256GB: +1 (رجع)
  - SSD 512GB: -1 (راح)
```

---

## 📊 قاعدة البيانات

### جدول القطع الداخلية (Parts)
| الحقل | النوع | الوصف |
|-------|-------|-------|
| id | UUID | معرف فريد |
| category | enum | الفئة (ram, storage, battery, screen, keyboard) |
| name | string | الاسم (DDR4 8GB, SSD 512GB M.2) |
| specifications | JSON | المواصفات التفصيلية |
| buy_price | decimal | سعر الشراء |
| sell_price | decimal | سعر البيع |
| quantity | int | الكمية بالمخزون |
| min_stock | int | الحد الأدنى (للتنبيه) |

### جدول عمليات الترقية (Upgrades)
| الحقل | النوع | الوصف |
|-------|-------|-------|
| id | UUID | معرف فريد |
| sale_id | FK | فاتورة البيع |
| device_id | FK | الجهاز (السيريال) |
| upgrade_type | enum | النوع (add, swap) |
| performed_by | FK | المجهز |
| performed_at | timestamp | التاريخ |
| labor_fee | decimal | أجرة التركيب |
| notes | text | ملاحظات |

### جدول تفاصيل الترقية (UpgradeItems)
| الحقل | النوع | الوصف |
|-------|-------|-------|
| id | UUID | معرف فريد |
| upgrade_id | FK | عملية الترقية |
| action | enum | الإجراء (added, removed) |
| part_id | FK | القطعة |
| from_device | boolean | من الجهاز؟ (removed) |
| to_device | boolean | للجهاز؟ (added) |
| price | decimal | السعر |

---

## 🖥️ واجهة المستخدم

### أثناء إنشاء الفاتورة:

```
╔════════════════════════════════════════════════════════════════════╗
║  🛒 فاتورة بيع جديدة                                              ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  الزبون: أحمد محمد                                                ║
║                                                                    ║
║  ─────────────────────────────────────────────────────────────    ║
║  المنتجات                                                         ║
║  ─────────────────────────────────────────────────────────────    ║
║                                                                    ║
║  1. BI-2025-001234 - Dell Latitude 7410                           ║
║     i7-11th | RAM 8GB | SSD 256GB                                 ║
║     السعر: 650,000                                                ║
║                                                                    ║
║     [ 🔧 إضافة ترقية ]                                            ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝
```

### عند الضغط على "إضافة ترقية":

```
╔════════════════════════════════════════════════════════════════════╗
║  🔧 ترقية جهاز: BI-2025-001234                                    ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  المواصفات الحالية:                                               ║
║  • المعالج: i7-11th                                               ║
║  • الرام: 8GB DDR4                                                ║
║  • التخزين: 256GB SSD M.2                                         ║
║                                                                    ║
║  ─────────────────────────────────────────────────────────────    ║
║  نوع الترقية: ( ) إضافة قطعة    (•) استبدال قطعة                 ║
║  ─────────────────────────────────────────────────────────────    ║
║                                                                    ║
║  القطعة المطلوبة:                                                  ║
║  ┌─────────────────────────────────────────────────────────┐      ║
║  │ الفئة:    [ الرام ▼ ]                                   │      ║
║  │                                                         │      ║
║  │ القطعة:  [ DDR4 16GB ▼ ]     المتوفر: 15 قطعة          │      ║
║  │                                                         │      ║
║  │ السعر:   75,000                                         │      ║
║  └─────────────────────────────────────────────────────────┘      ║
║                                                                    ║
║  ⚠️ سيتم:                                                         ║
║  • سحب: DDR4 8GB من الجهاز → المخزون (+1)                        ║
║  • تركيب: DDR4 16GB من المخزون → الجهاز (-1)                     ║
║                                                                    ║
║  التكلفة الإضافية: 75,000 د.ع                                     ║
║  أجرة التركيب: 10,000 د.ع                                         ║
║  ──────────────────────                                           ║
║  الإجمالي: 85,000 د.ع                                             ║
║                                                                    ║
║              [ إلغاء ]    [ ✓ تأكيد الترقية ]                     ║
╚════════════════════════════════════════════════════════════════════╝
```

### بعد تأكيد الترقية:

```
╔════════════════════════════════════════════════════════════════════╗
║  🛒 فاتورة بيع جديدة                                              ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  الزبون: أحمد محمد                                                ║
║                                                                    ║
║  ─────────────────────────────────────────────────────────────    ║
║  المنتجات                                                         ║
║  ─────────────────────────────────────────────────────────────    ║
║                                                                    ║
║  1. BI-2025-001234 - Dell Latitude 7410                           ║
║     i7-11th | RAM 8GB→16GB 🔧 | SSD 256GB                         ║
║     السعر: 650,000                                                ║
║     ├─ ترقية رام: +75,000                                         ║
║     └─ أجرة تركيب: +10,000                                        ║
║     ─────────────                                                  ║
║     المجموع: 735,000                                              ║
║                                                                    ║
║     [ 🔧 تعديل الترقية ]  [ ✕ إزالة الترقية ]                     ║
║                                                                    ║
║  ─────────────────────────────────────────────────────────────    ║
║                                                                    ║
║  الإجمالي: 735,000 د.ع                                            ║
║                                                                    ║
║              [ إضافة منتج ]    [ ✓ حفظ الفاتورة ]                 ║
╚════════════════════════════════════════════════════════════════════╝
```

---

## 📦 تأثير على المخزون

### عند حفظ الفاتورة:

```
تلقائياً:
┌─────────────────────────────────────────────────────────────┐
│  المخزون - حركات تلقائية                                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  DDR4 8GB                                                   │
│  ├─ قبل: 23 قطعة                                           │
│  ├─ + 1 (مسحوب من جهاز BI-2025-001234)                     │
│  └─ بعد: 24 قطعة ✅                                        │
│                                                             │
│  DDR4 16GB                                                  │
│  ├─ قبل: 15 قطعة                                           │
│  ├─ - 1 (مركب بجهاز BI-2025-001234)                        │
│  └─ بعد: 14 قطعة ✅                                        │
│                                                             │
│  الجهاز BI-2025-001234                                      │
│  ├─ مواصفات قبل: RAM 8GB                                   │
│  └─ مواصفات بعد: RAM 16GB ✅                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 📍 سجل حركة الجهاز (محدث)

```
🔍 BI-2025-001234

...
2025-01-20 11:00 │ 🛒 بيع - أحمد محمد
                 │    فاتورة: INV-2025-0256
                 │    
2025-01-20 11:05 │ 🔧 ترقية رام
                 │    نوع: استبدال
                 │    سحب: DDR4 8GB → المخزون
                 │    تركيب: DDR4 16GB
                 │    بواسطة: حيدر
                 │    
2025-01-20 11:30 │ 📹 تجهيز للشحن
...
```

---

## 💰 تأثير على الفاتورة

```
فاتورة بيع: INV-2025-0256
─────────────────────────────────────────────

الجهاز: Dell Latitude 7410 (BI-2025-001234)
  السعر الأساسي:                    650,000

الترقيات:
  + رام DDR4 16GB (استبدال):         75,000
  + أجرة تركيب:                      10,000
  - خصم رام 8GB المسحوب:            -25,000
                                   ─────────
  صافي الترقية:                      60,000

─────────────────────────────────────────────
الإجمالي:                           710,000
─────────────────────────────────────────────
```

---

## ⚙️ إعدادات

### أجور التركيب:
| نوع العملية | الأجرة الافتراضية |
|-------------|-------------------|
| ترقية رام | 10,000 |
| ترقية/تبديل هارد | 15,000 |
| تبديل بطارية | 10,000 |
| تبديل شاشة | 50,000 |
| تبديل كيبورد | 25,000 |

### خصم القطع المسحوبة:
```
القطعة المسحوبة من الجهاز يمكن:
[ ] خصمها من سعر الترقية (حسب سعر البيع)
[✓] عدم خصمها (القطعة ترجع للمخزون فقط)
[ ] خصم نسبة مئوية: [50]%
```

---

## 📋 تقارير

### تقرير الترقيات:
```
تقرير ترقيات الشهر
──────────────────────────────────────────

إجمالي الترقيات: 45 عملية
إجمالي الإيرادات: 3,250,000 د.ع

القطع الأكثر طلباً:
1. رام 16GB DDR4 - 23 عملية
2. SSD 512GB - 12 عملية
3. رام 32GB DDR4 - 7 عملية

القطع المسحوبة (عادت للمخزون):
1. رام 8GB DDR4 - 18 قطعة
2. SSD 256GB - 8 قطع
3. رام 16GB DDR4 - 5 قطع
```
