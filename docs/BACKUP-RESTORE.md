# النسخ الاحتياطي والاستعادة — BI Smart Management

---

## ١. النسخ الاحتياطي

### يدوياً
- من الـ Backend: استدعاء خدمة النسخ الاحتياطي (مثلاً عبر مسار API إن وُجد: `POST /api/backup/create` أو من السكربتات).
- أو تشغيل: `npm run backup:create` من مجلد `backend` إن كان مضافاً في `package.json`.
- الملفات تُحفظ في مجلد `backend/backups/` بصيغة مثل `backup-YYYY-MM-DDTHH-mm-ss.db`.

### تلقائياً
- **الساعة 2:00 صباحاً** يتم تشغيل نسخة احتياطية يومية تلقائياً من خلال Scheduler (تم إضافتها حسب طلب لوحة المدير).
- يتم الاحتفاظ بآخر **30 نسخة**؛ يتم حذف الأقدم تلقائياً.

### خارج السيرفر (موصى به للمدير)
- انسخ ملفات مجلد `backups/` بشكل دوري إلى جهاز آخر أو تخزين سحابي (مثلاً عبر سكربت أو مهمة مجدولة).
- راجع `docs/DEPLOYMENT-CHECKLIST.md` لتفاصيل "نسخ احتياطي خارج السيرفر".

---

## ٢. الاستعادة

1. **إيقاف التطبيق** (Backend) إن أمكن لتجنب كتابة متزامنة على قاعدة البيانات.
2. **استبدال ملف قاعدة البيانات الحالي** بنسخة الاحتياطية:
   - النسخة الحالية: حسب `DATABASE_PATH` في `.env` (افتراضياً `data/bi_management.db`).
   - انسخ ملف النسخة الاحتياطية (مثلاً `backup-2026-02-06T02-00-00.db`) إلى مسار `DATABASE_PATH` وأعد تسميته ليطابق اسم الملف المتوقع (مثلاً `bi_management.db`).
3. **إعادة تشغيل الـ Backend** والتحقق من أن التطبيق يعمل ويسجل الدخول بنجاح.

### استعادة عبر واجهة/API
- إن وُجد مسار استعادة (مثلاً `POST /api/backup/restore`) فاتبع وثائق الـ API؛ عادةً يلزم صلاحية عالية (مثل owner/admin).

---

## ٣. التحقق

- بعد الاستعادة: التحقق من تسجيل الدخول، وفتاح لوحة المدير، وعرض بعض الفواتير أو التقارير للتأكد من سلامة البيانات.
