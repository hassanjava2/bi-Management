# التحقق من الواجهة الجديدة (ERP)

> توثيق ما تمت إضافته في الواجهة وكيفية التأكد من الربط مع الـ API.

---

## 1. واجهة واحدة فقط

- **مجلد الواجهة المستخدم:** `frontend/` (هذا هو المشروع الذي تم تطويره).
- **لا يوجد واجهة "قديمة" و"جديدة" منفصلتان** — كل التعديلات في نفس المشروع `frontend/`.
- المسارات والصفحات الجديدة مضافة داخل **نفس** `App.jsx` و **نفس** `Sidebar.jsx`، وتظهر داخل **نفس** الـ Layout (شريط جانبي + هيدر).

---

## 2. ما الذي تمت إضافته في الواجهة؟

### الصفحات الجديدة (ملفات في `frontend/src/pages/`)

| الصفحة | الملف | الوظيفة |
|--------|------|---------|
| قوائم الانتظار | `WaitingInvoicesPage.jsx` | فواتير قوائم الانتظار (انتظار → فعالة) |
| لوحة المندوب | `RepDashboardPage.jsx` | مبيعاتي، عدد الفواتير، فواتير متأخرة التسديد |
| أونلاين حاسبة | `CalculatorPage.jsx` | محادثة علنية + المسار الدوري (إضافة زيارة) |
| المواد الثابتة | `FixedAssetsPage.jsx` | أصول، إضافة أصل، تعيين مسؤول (ذمة موظف) |
| الأسهم والشراكة | `SharesPage.jsx` | نوع نظام الأسهم، المساهمون، إجمالي الأسهم |

### المسارات في `App.jsx`

كل المسارات التالية **داخل** الـ Layout (يعني يظهر الشريط الجانبي):

| المسار | الصفحة |
|--------|--------|
| `/sales/waiting` | WaitingInvoicesPage |
| `/rep-dashboard` | RepDashboardPage |
| `/calculator` | CalculatorPage |
| `/fixed-assets` | FixedAssetsPage |
| `/shares` | SharesPage |

### روابط الشريط الجانبي في `Sidebar.jsx`

| أين تظهر | الرابط | النص |
|----------|--------|------|
| المبيعات → أطفال | `/sales/waiting` | قوائم الانتظار |
| الإدارة → أطفال | `/fixed-assets` | المواد الثابتة |
| الإدارة → أطفال | `/calculator` | أونلاين حاسبة |
| الإدارة → أطفال | `/shares` | الأسهم والشراكة |
| عنصر مستقل | `/rep-dashboard` | لوحة المندوب |

---

## 3. ربط كل صفحة بالـ API (الواجهة الجديدة مربوطة)

| الصفحة | استدعاءات الـ API |
|--------|-------------------|
| **WaitingInvoicesPage** | `GET /invoices/waiting` |
| **RepDashboardPage** | `GET /reports/rep-dashboard` |
| **CalculatorPage** | `GET/POST /calculator/chat` ، `GET/POST /calculator/routes` ، `GET /customers` (للقائمة عند إضافة زيارة) |
| **FixedAssetsPage** | `GET/POST /fixed-assets` ، `PATCH /fixed-assets/:id/assign` ، `GET /users` (لتعيين المسؤول) |
| **SharesPage** | `GET /shares/config` ، `GET /shares/summary` |

الواجهة تستخدم `frontend/src/services/api.js` و الـ `baseURL` هي `/api`، فكل الطلبات تذهب إلى نفس الباكند (مثلاً `http://localhost:3000/api` إذا كان البروكسي يوجّه `/api` للباكند).

---

## 4. كيف تتأكد أن الواجهة الجديدة مربوطة ولا شيء ناقص؟

### خطوات التحقق

1. **تشغيل الباكند**
   ```bash
   cd backend
   npm start
   ```

2. **تشغيل الواجهة**
   ```bash
   cd frontend
   npm run dev
   ```

3. **تسجيل الدخول** ثم فتح كل رابط من الجدول أدناه والتأكد أن الصفحة تفتح **ولا** تظهر صفحة 404 أو "الصفحة غير موجودة":

| الرابط (بعد تسجيل الدخول) | المتوقع |
|---------------------------|---------|
| `/sales/waiting` | صفحة قوائم الانتظار (جدول فواتير أو رسالة لا توجد بيانات) |
| `/rep-dashboard` | لوحة المندوب (مبيعاتي، فواتير متأخرة) |
| `/calculator` | تبويبان: المحادثة + المسار الدوري، مع إمكانية إضافة زيارة |
| `/fixed-assets` | جدول أصول + زر "إضافة أصل" + زر "تعيين" بجانب كل أصل |
| `/shares` | نوع نظام الأسهم + جدول المساهمين |

4. **فحص الشبكة (Network)** في أدوات المطور (F12):
   - عند فتح كل صفحة أعلاه يجب أن ترى طلبات إلى `/api/...` (مثل `/api/reports/rep-dashboard`، `/api/fixed-assets`، إلخ).
   - إذا ظهرت الطلبات وتمت الإجابة (200 أو 401 إن لم تكن مسجّل دخول) فالواجهة **مربوطة** بالباكند.

---

## 5. إذا "القديمة نفسها" أو ما يظهر شي جديد

- **التصميم (الألوان/الشكل):** لم نغيّر تصميم الـ Layout العام؛ فقط أضفنا **صفحات جديدة** و**روابط في الشريط الجانبي**. لذلك الشكل العام يبقى مثل السابق، لكن المحتوى عند الضغط على الروابط الجديدة هو الجديد.
- **ما الذي يجب أن يتغيّر عندك:**
  - تحت **المبيعات** يظهر رابط **«قوائم الانتظار»**.
  - تحت **الإدارة** تظهر: **المواد الثابتة**، **أونلاين حاسبة**، **الأسهم والشراكة**.
  - في الشريط الجانبي عنصر **«لوحة المندوب»** يظهر (حسب الصلاحيات).
- إذا **لا** ترى هذه الروابط:
  - تأكد أنك تفتح المشروع من مجلد **`frontend`** وأن السيرفر الذي يعمل هو من هذا المجلد (`npm run dev`).
  - تأكد أن الملف الذي يُعدّل للشريط هو `frontend/src/components/layout/Sidebar.jsx` وليس ملفاً في مشروع آخر.
  - **الصلاحيات:** عناصر "الإدارة" (المواد الثابتة، الحاسبة، الأسهم) تظهر للمستخدمين بدور **admin** فقط. "لوحة المندوب" تظهر لـ **admin، manager، sales**. "قوائم الانتظار" تحت المبيعات تظهر لـ **admin، manager، sales**. إذا كنت بدور آخر قد لا ترى بعض الروابط.

---

## 6. ملخص

| السؤال | الجواب |
|--------|--------|
| هل الواجهة الجديدة مضافة؟ | نعم — 5 صفحات جديدة + مساراتها + روابط الشريط الجانبي في `frontend/`. |
| هل هي مربوطة بالـ API؟ | نعم — كل الصفحات الجديدة تستدعي مسارات الـ API المذكورة أعلاه عبر `api.js`. |
| هل الواجهة "الجديدة" مشروع آخر؟ | لا — واجهة واحدة فقط (`frontend/`)، والجديد مضاف فيها. |
| كيف أتأكد أن لا شيء ناقص؟ | تشغيل الباكند والواجهة، تسجيل الدخول، فتح كل رابط في الجدول أعلاه ومراجعة Network. |

---

*آخر تحديث: 2026-02-06*
