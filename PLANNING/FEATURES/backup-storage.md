# 💾 نظام النسخ الاحتياطي والتخزين

## 🏗️ البنية المقترحة

```
┌─────────────────────────────────────────────────────────────────┐
│                        السحابة (Cloud)                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │  قاعدة      │  │   الصور     │  │  الفيديو    │          │
│  │  البيانات   │  │   والملفات  │  │             │          │
│  │  (Primary)  │  │  (Storage)  │  │  (Storage)  │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
         │                    │                   │
         │         🔄 مزامنة يومية تلقائية       │
         │                    │                   │
         ▼                    ▼                   ▼
┌─────────────────────────────────────────────────────────────────┐
│                    جهازك / السيرفر المحلي                       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │  نسخة       │  │   نسخة      │  │  نسخة       │          │
│  │  احتياطية   │  │   الصور     │  │  الفيديو    │          │
│  │  (Backup)   │  │  (Backup)   │  │  (Backup)   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
```

---

## ☁️ التخزين السحابي

### الخيارات المقترحة:

| الخدمة | المساحة | السعر/شهر | الميزات |
|--------|---------|-----------|---------|
| **Supabase** | 8GB مجاني | مجاني ثم $25 | قاعدة بيانات + تخزين |
| **Firebase** | 5GB مجاني | حسب الاستخدام | سهل + سريع |
| **DigitalOcean** | 250GB | $5 | تحكم كامل |
| **Cloudflare R2** | 10GB مجاني | رخيص جداً | سريع + رخيص |

### التوصية:
```
قاعدة البيانات: Supabase (PostgreSQL)
  - مجاني حتى 500MB
  - سهل الاستخدام
  - API جاهز

الصور والفيديو: Cloudflare R2
  - 10GB مجاني
  - لا رسوم للتنزيل (مهم للنسخ الاحتياطي)
  - سريع
```

---

## 💾 النسخ الاحتياطي

### جدول النسخ:

| النوع | التكرار | المكان | الحجم المتوقع |
|-------|---------|--------|---------------|
| قاعدة البيانات | كل ساعة | السحابة | ~100MB |
| قاعدة البيانات | يومي | جهازك | ~100MB |
| الصور | يومي | جهازك | ~1-5GB |
| الفيديو | أسبوعي | قرص خارجي | ~10-50GB |

### الأجهزة المخولة:

```
╔════════════════════════════════════════════════════════════╗
║  ⚙️ إعدادات النسخ الاحتياطي                               ║
╠════════════════════════════════════════════════════════════╣
║                                                            ║
║  الأجهزة المخولة لسحب النسخة الاحتياطية:                  ║
║                                                            ║
║  ┌────────────────────────────────────────────────────┐   ║
║  │ ✅ جهاز المدير (DESKTOP-BI-MAIN)                  │   ║
║  │    آخر نسخة: 2025-01-20 23:00                     │   ║
║  │    [إزالة]                                        │   ║
║  ├────────────────────────────────────────────────────┤   ║
║  │ ✅ لابتوب المدير (LAPTOP-BI)                      │   ║
║  │    آخر نسخة: 2025-01-19 18:30                     │   ║
║  │    [إزالة]                                        │   ║
║  └────────────────────────────────────────────────────┘   ║
║                                                            ║
║  [ + إضافة جهاز جديد ]                                    ║
║                                                            ║
║  ─────────────────────────────────────────────────────    ║
║                                                            ║
║  إعدادات النسخ التلقائي:                                  ║
║                                                            ║
║  [✓] نسخ يومي تلقائي الساعة: [ 23:00 ]                   ║
║  [✓] تنبيه إذا فشل النسخ                                  ║
║  [✓] الاحتفاظ بآخر [ 30 ] نسخة                           ║
║                                                            ║
╚════════════════════════════════════════════════════════════╝
```

---

## 🔄 سير عمل النسخ الاحتياطي

### النسخ التلقائي اليومي:

```
كل يوم الساعة 23:00
        │
        ▼
┌─────────────────────────────────────────┐
│  1. تصدير قاعدة البيانات (SQL dump)    │
│     - جميع الجداول                     │
│     - آخر 24 ساعة من التغييرات        │
└─────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────┐
│  2. ضغط الملف                          │
│     backup_2025-01-20.zip              │
└─────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────┐
│  3. رفع للسحابة                        │
│     ✅ تم الرفع                        │
└─────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────┐
│  4. إشعار للأجهزة المخولة              │
│     "نسخة جديدة متوفرة للتحميل"        │
└─────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────┐
│  5. الجهاز المخول يحمّل تلقائياً       │
│     D:\BI-Backups\2025-01-20.zip      │
└─────────────────────────────────────────┘
```

### النسخ اليدوي:

```
╔════════════════════════════════════════════════════════════╗
║  💾 النسخ الاحتياطي                                        ║
╠════════════════════════════════════════════════════════════╣
║                                                            ║
║  آخر نسخة: 2025-01-20 23:00 ✅                            ║
║  الحجم: 156 MB                                            ║
║                                                            ║
║  [ 📥 تحميل آخر نسخة ]                                    ║
║                                                            ║
║  [ 🔄 إنشاء نسخة الآن ]                                   ║
║                                                            ║
║  ─────────────────────────────────────────────────────    ║
║                                                            ║
║  النسخ السابقة:                                           ║
║  ├─ 2025-01-20 23:00 (156 MB) [تحميل]                    ║
║  ├─ 2025-01-19 23:00 (154 MB) [تحميل]                    ║
║  ├─ 2025-01-18 23:00 (152 MB) [تحميل]                    ║
║  └─ ...                                                   ║
║                                                            ║
╚════════════════════════════════════════════════════════════╝
```

---

## 🔐 الأمان

### تشفير النسخ:
```
[✓] تشفير النسخة الاحتياطية (AES-256)
    كلمة مرور: ********
    
⚠️ احتفظ بكلمة المرور! بدونها لا يمكن استعادة البيانات
```

### التحقق من الجهاز:
```
عند إضافة جهاز جديد:

1. تسجيل الدخول بحساب المدير
2. إدخال رمز تحقق (يُرسل للموبايل)
3. تسمية الجهاز
4. ✅ الجهاز مخول الآن
```

---

## 📱 تطبيق النسخ الاحتياطي (للجهاز)

```
تطبيق صغير يعمل بالخلفية:

┌─────────────────────────────────────────┐
│  🔄 BI Backup Sync                      │
│  ─────────────────────────────────────  │
│                                         │
│  الحالة: متصل ✅                        │
│                                         │
│  آخر مزامنة: قبل 2 ساعة                │
│  النسخ المحلية: 30                      │
│  المساحة المستخدمة: 4.2 GB             │
│                                         │
│  [مزامنة الآن]                          │
│                                         │
│  ─────────────────────────────────────  │
│  📁 مجلد النسخ: D:\BI-Backups          │
│  [تغيير]                                │
└─────────────────────────────────────────┘
```

---

## 🔄 استعادة البيانات

### من السحابة:
```
1. تسجيل الدخول
2. اختيار "استعادة من نسخة"
3. اختيار النسخة المطلوبة
4. تأكيد (يحتاج رمز تحقق)
5. ⏳ جاري الاستعادة...
6. ✅ تم!
```

### من النسخة المحلية (أوفلاين):
```
إذا انقطع الإنترنت:

1. تشغيل النظام محلياً
2. استيراد من ملف: D:\BI-Backups\2025-01-20.zip
3. إدخال كلمة مرور التشفير
4. ✅ تم استعادة البيانات
5. العمل أوفلاين...
6. عند عودة الإنترنت → مزامنة التغييرات
```

---

## 📊 مساحة التخزين المتوقعة

### شهرياً:
| النوع | الحجم التقريبي |
|-------|----------------|
| قاعدة البيانات | 50-100 MB |
| صور الفحص | 2-5 GB |
| صور العيوب | 500 MB - 1 GB |
| فيديو الشحن | 5-15 GB |
| **المجموع** | **~10-20 GB/شهر** |

### سنوياً:
```
~120-240 GB للسنة الأولى

توصية:
- قرص خارجي 1TB للأرشيف
- حذف الفيديوهات القديمة (أكثر من 6 شهور)
- الاحتفاظ بالصور (أخف)
```
